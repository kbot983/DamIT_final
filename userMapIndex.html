<html>

<head>
    <!--<script src="http://code.jquery.com/jquery-1.9.1.js"></script>-->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnl5j-_c1T7bMQKBb2ijlJx87NP2akmrQ&async=false"></script>
    <script>
        navigator.geolocation.getCurrentPosition(function (position) {
            var userLat = position.coords.latitude;
            var userLng = position.coords.longitude;
            
        });
    </script>

    <script type="text/javascript" src="./js/jquery.min.js"></script>
    <script type "text/javascript" src="./js/offlinemode.js"></script>
    <link rel="stylesheet" href="./css/materialize.min.css">
    <script src="./js/materialize.min.js"></script>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/userView.css">
    <style>
        /*id for userview on modal*/

        #DownMod {
            width: 100%;
            max-height: 100vh;
            height: 100vh;
            bottom: -10%;
        }
    </style>
</head>

<body>



    <!-- ############## Modal ##############-->
    <div id="modal1" class="modal">
        <div class="modal-content">
            <h4>Confirm</h4>
            <p>Should DamIT sent an SOS ?</p>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-red btn-flat ">Disagree</a>
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Agree</a>
        </div>
    </div>


    <div id="DownMod" class="modal">
        <!-- userscreen inside modal starts-->
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" style="display: none;">
            <symbol id="wave">
                <path d="M420,20c21.5-0.4,38.8-2.5,51.1-4.5c13.4-2.2,26.5-5.2,27.3-5.4C514,6.5,518,4.7,528.5,2.7c7.1-1.3,17.9-2.8,31.5-2.7c0,0,0,0,0,0v20H420z"></path>
                <path d="M420,20c-21.5-0.4-38.8-2.5-51.1-4.5c-13.4-2.2-26.5-5.2-27.3-5.4C326,6.5,322,4.7,311.5,2.7C304.3,1.4,293.6-0.1,280,0c0,0,0,0,0,0v20H420z"></path>
                <path d="M140,20c21.5-0.4,38.8-2.5,51.1-4.5c13.4-2.2,26.5-5.2,27.3-5.4C234,6.5,238,4.7,248.5,2.7c7.1-1.3,17.9-2.8,31.5-2.7c0,0,0,0,0,0v20H140z"></path>
                <path d="M140,20c-21.5-0.4-38.8-2.5-51.1-4.5c-13.4-2.2-26.5-5.2-27.3-5.4C46,6.5,42,4.7,31.5,2.7C24.3,1.4,13.6-0.1,0,0c0,0,0,0,0,0l0,20H140z"></path>
            </symbol>
        </svg>
        <div class="circle_new">
            <div class="riverbed">
                <div class="liquid" id="Counter">
                    <h2 id="percentage" style="color:#000"></h2>
                    <br>
                </div>
                <center>
                    <div class="total">
                        <h2 id="total"></h2>
                    </div>
                </center>
                <div id="water" class="water">
                    <svg viewBox="0 0 560 20" class="water_wave water_wave_back">
                        <use xlink:href="#wave"></use>
                    </svg>
                    <svg viewBox="0 0 560 20" class="water_wave water_wave_front">
                        <use xlink:href="#wave"></use>
                    </svg>
                </div>
            </div>
        </div>
        <!--fullscreen custom code ends here-->
        <div>
            <input type="text" id="txtLevel" value="50" style="display: none;" placeholder="Select Water Level" />
            <button type="button" id="btnShow" value="Show" style="display: none;" onclick="fillwater(document.getElementById('txtLevel').value)">Show</button>
        </div>
        <script>
            function fillwater(fillno, showTextContainerId) {
                var water = document.getElementById("water");
                var percent = 0;
                var interval;
                interval = setInterval(function () {
                    percent++;
                    if (showTextContainerId !== undefined) { document.getElementById(showTextContainerId).innerHTML = percent + '%'; }
                    water.style.transform = 'translate(0' + ',' + (100 - percent) + '%)';
                    if (percent == parseInt(fillno)) {
                        clearInterval(interval);
                    }
                }, 60);
            }
        </script>
        <script>
            //Added document.ready
            $(document).ready(function () {
                $(".button-collapse").sideNav();
                $('select').material_select();
                var datastring = "email=" + localStorage.getItem('username');
                $.ajax({
                    type: 'post',
                    async: false,
                    data: datastring,
                    url: 'http://www.occasionz.in/damit/userMainPage.php',
                    success: function (response) {
                        a = JSON.parse(response);
                        $('#percentage').text(a[0] + "%");
                        $('#total').text(a[1] + "M");
                        $('#txtLevel').val(a[0]);
                        $('#btnShow').trigger('click');
                        localStorage.setItem("damname", a[3]);
                        console.log(a[0]);
                    }
                });
            });
        </script>
        <!--userscreen inside modal ends -->
    </div>







    <ul id="slide-out" class="side-nav">
        <li>
            <div class="userView ">
                <div class="background">
                    <img src="img/back_login.jpg">

                </div>
                <a href="userProfile.html">
                    <img class="circle" src="img/prsn.jpg">
                </a>

                <a href="userProfile.html">
                    <span class="white-text name">Chintan Popat</span>
                </a>
                <a href="userProfile.html">
                    <span class="white-text email">email@domain.com</span>
                </a>
            </div>
        </li>
        <li>
            <a href="User_Index.html">Home</a>
        </li>
        <li>
            <a href="UserSchedule.html">Schedule</a>
        </li>
        <li>
            <a href="blog.html">Dam Guide</a>
        </li>
        <li>
            <a class='dropdown-button white' href='#' data-activates='dropdown1'>Change Language</a>

            <ul id='dropdown1' class='dropdown-content '>
                <li>
                    <a href="#!" class="blue-text">Hindi</a>
                </li>
                <li>
                    <a href="#!" class="blue-text">English</a>
                </li>
                <li>
                    <a href="#!" class="blue-text">Gujarati</a>
                </li>
                <li>
                    <a href="#!" class="blue-text">Marathi</a>
                </li>
            </ul>
        </li>
        <li>
            <div class="divider"></div>
        </li>
        <li>
            <a class="waves-effect waves-light btn btn-flat" id="logout">Logout</a>
        </li>
    </ul>
    <!--for login-->
    <script>
        $(document).ready(function () {
            if (localStorage.getItem("loggedin") == "0") {
                window.location.href = "login.html";
            }
        });
    </script>
    <!--login code ends-->
    <nav class="nav-wrapper light-blue darken-1">
        <a href="#" data-activates="slide-out" class="button-collapse show-on-large">
            <i class="material-icons">menu</i>
        </a>
        <a href="#" class="brand-logo center">DamIT</a>
    </nav>

    <div class="fixed-action-btn">
        <a class="btn-floating btn-large waves-effect waves-light light-blue lighten-1 pulse" style="position:fixed; bottom:15;right:8;">
            <i class="material-icons">add</i>
        </a>
        <ul>
            <li>
                <a href="#DownMod" class="btn-floating light-blue darken-1" style="bottom:0;right:35;">
                    <i class="material-icons">insert_chart</i>
                </a>
            </li>
            <li>
                <a href="#modal1" class="btn-floating red" style="bottom:0;right:35;">
                    <i class="material-icons">add_alert</i>
                </a>
            </li>
        </ul>
    </div>

    <div class="col s10" style="position:fixed; bottom:-6px;right:60; z-index: 10;">
        <div id="lblHolder" style="padding: 4%;padding-right: 4%;margin: 5.5rem 7px 25px 2px;">
            <span class="white-text" id="lblMessage"></span>
        </div>
    </div>

    <div id="googleMap" style="width:100%;height:95%;"></div>

    <script>

        // var userLat = 26.4498051;
        // var userLng = 80.1919236;


        //Safe Zone
        // var userLat = 30.3709334;
        // var userLng = 78.4725065;




        //Danger Zone
        // var userLat = 30.3784067;
        // var userLng = 78.4824828;
        // var userLat;
        // var userLng;
        function abc() {
            var damLat = 30.379428;
            var damLng = 78.48323;

            var mapCenter = new google.maps.LatLng(damLat, damLng);
            var userCentre = new google.maps.LatLng(userLat, userLng);
            alert(userCentre);
            var issafe = 1;

            google.maps.event.addDomListener(window, "load", initialize);

            //}, 5000);
        }

        function initialize() {
            var mapCanvas = document.getElementById("googleMap");
            var mapOptions = { center: userCentre, zoom: 16, streetViewControl: false };
            var map = new google.maps.Map(mapCanvas, mapOptions);

            var cityCircle = new google.maps.Circle({
                strokeColor: (issafe === 1 ? '#0000FF' : '#FF0000'),
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: (issafe === 1 ? '#0000FF' : '#FF0000'),
                fillOpacity: 0.35,
                map: map,
                center: mapCenter,
                radius: 500
            });

            var indanger = cityCircle.getBounds().contains(userCentre);

            if (indanger == false) {
                var ltlnglst = new Array(mapCenter, userCentre);
                var bound = new google.maps.LatLngBounds();

                for (var i = 0, l = ltlnglst.length; i < l; i++) {
                    bound.extend(ltlnglst[i]);
                }
                map.fitBounds(bound);
            }

            var msg = '';
            if (issafe == 1 && (indanger == true) || (indanger == false)) {
                msg = "You are " + getDistanceFromLatLonInKm(userLat, userLng, damLat, damLng) + " Km away from the Water resource.";
            }
            else if (issafe == 0 && indanger == true) {
                msg = "You are in the Danger Zone";
            }
            else if (issafe == 0 && indanger == false) {
                msg = "You are " + getDistanceFromLatLonInKm(userLat, userLng, damLat, damLng) + " Km away from the Danger Zone.";
            }

            document.getElementById('lblHolder').className = issafe == 1 ? "card-panel light-blue lighten-1" : "card-panel red lighten-1"
            document.getElementById('lblMessage').innerHTML = msg;

            var marker = new google.maps.Marker({
                position: userCentre,
                icon: 'http://maps.google.com/mapfiles/ms/icons/blue.png',
                map: map

            });
            marker.setMap(map);
        }


        $(document).ready(function () {
            $('.modal').modal();
            $(".button-collapse").sideNav();
            $('select').material_select();
        });

        function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
            var R = 6371; // Radius of the earth in km
            var dLat = deg2rad(lat2 - lat1);  // deg2rad below
            var dLon = deg2rad(lon2 - lon1);
            var areee =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2)
                ;
            var c = 2 * Math.atan2(Math.sqrt(areee), Math.sqrt(1 - areee));
            var d = R * c; // Distance in km
            return d.toFixed(2);
        }

        function deg2rad(deg) {
            return deg * (Math.PI / 180)
        }

    </script>

</body>

</html>